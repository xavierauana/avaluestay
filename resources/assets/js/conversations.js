// Generated by CoffeeScript 1.9.3
(function() {
  var conversations;

  if (document.getElementsByClassName("conversations").length > 0) {
    conversations = new Vue({
      el: ".conversations",
      data: {
        senderId: "",
        receiverId: ""
      },
      methods: {
        messageStream: function() {
          var self;
          self = this;
          return $.ajax({
            url: "/messages/sender/" + this.receiverId + "/receiver/" + this.senderId,
            method: "GET"
          }).success(function(data) {
            data.map(function(message) {
              return self.stickOthersMessageOnBoard(message.message);
            });
            return console.log(data);
          }).always(function() {
            return console.log("ajax fire");
          });
        },
        stickMyMessageOnBoard: function(message) {
          var template;
          template = $(".mine.hidden").clone().removeClass("hidden");
          template.find("p").text(message);
          template.find("small p").text("now");
          template.appendTo("div.messageBox");
          return $('.messageBox').animate({
            "scrollTop": $('.messageBox')[0].scrollHeight
          }, "slow");
        },
        stickOthersMessageOnBoard: function(message) {
          var template;
          template = $(".sender.hidden").clone().removeClass("hidden");
          template.find("p").text(message);
          template.find("small p").text("now");
          template.appendTo("div.messageBox");
          return $('.messageBox').animate({
            "scrollTop": $('.messageBox')[0].scrollHeight
          }, "slow");
        },
        newMessage: function(e) {
          var form, message, token;
          e.preventDefault();
          message = e.target.message.value;
          if (message) {
            this.stickMyMessageOnBoard(message);
            form = $(e.target);
            token = $('meta[name="csrf-token"]').attr('content');
            $.ajaxSetup({
              headers: {
                'X-CSRF-TOKEN': token
              }
            });
            $.ajax({
              url: form.attr("action"),
              method: form.attr("method"),
              data: form.serialize()
            }).success(function(data) {
              return console.log(data);
            });
          }
          return e.target.message.value = "";
        }
      },
      ready: function() {
        var temp;
        temp = $("form").attr("action").split("/");
        this.senderId = temp[3];
        this.receiverId = temp[5];
        return $('.messageBox').animate({
          "scrollTop": $('.messageBox')[0].scrollHeight
        }, "fast");
      }
    });
  }

}).call(this);

//# sourceMappingURL=conversations.js.map
